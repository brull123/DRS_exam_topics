\documentclass[../exam_questions.tex]{subfiles}

\begin{document}

\chapter{Lecture 14}
% -------------------------------------------------------------------------
\section{Define the consensus/synchronization problem in states and outputs. Explain the difference between homogeneous and heterogeneous agents.}
\begin{definition}{Consensus/synchronization problem}{}
	The goal is to reach a state or output consensus
	\begin{align}
		||x_i - x_j|| & \rightarrow 0, \: {\rm for}\: t\rightarrow \infty, \:{\rm or} \\
		||y_i - y_j|| & \rightarrow 0, \: {\rm for}\: t\rightarrow \infty.
	\end{align}
	In case of leader following the problem is defined as
	\begin{align}
		||x_i - x_0|| & \rightarrow 0, \: {\rm for}\: t\rightarrow \infty, \: {\rm or} \\
		||y_i - y_0|| & \rightarrow 0, \: {\rm for}\: t\rightarrow \infty,
	\end{align}
	where the leader is uncontrolled
	\begin{align}
		\dot{x}_0 & = A x_0 \\
		y_0       & = C x_0
	\end{align}
\end{definition}

\begin{definition}{Agents}{}
	Agents are autonomous subsystems, with dynamics having a state description generally in $\R^n$ - $x_i \in \R^{n_i}, \: i = 1,\dots, N$.
	Agents are assumed to have local computation and communication capabilities.
\end{definition}
\subsection{Homogeneous agents}
Each of the agents can be described by a general LTI system
\begin{align}
	\dot{x}_i & = Ax_i + Bu_i \\
	y_i       & = Cx_i
\end{align}

The control problem for an multi-agent system is asymptotic state synchronization
\begin{align}
	||x_i - x_j|| \rightarrow 0, \: \forall (i, j) \: {\rm as} \: t \rightarrow \infty
\end{align}

\pagebreak
\subsection{Heterogeneous agents}
Heterogeneous agents assume that systems of individual agents may differ from each other, their states may differ in dimensions $x_i \in \R^{n_i},\: n_i \neq n_j$
and therefore the state synchronization problem cannot be posed. Even if the dimensions were the same, the state variables may be different and it would make no sense to synchronize such different state variables.


Instead, the control goal is asymptotic synchronization of outputs.
\begin{align}
	||y_i - y_j|| \rightarrow 0, \: \forall (i, j) \: {\rm as} \: t \rightarrow \infty
\end{align}

% -------------------------------------------------------------------------
\section{Write the single-integrator leaderless consensus dynamics in continuous time. How to include a leader?}
The single-integrator agents have a dynamic model
\begin{align}
	\dot{x}_i = u_i,
\end{align}
with local neighborhood error in the states for control,
\begin{align}
	u_i & = \sum_{j} e_{ij}(x_j - x_i),
\end{align}
where $e_{ij}$ are the elements of the adjacency matrix $E$. The standard notation conflicts with state-space matrix $A$.
The elements can either be binary to signify which agents are connected to which or they can be weights.

The control input is available to each single-agent in a distributed way. This results in a closed-loop system
\begin{align}
	\dot{x}_i & = \sum_j e_{ij}(x_j - x_i) \\
\end{align}

For every edge from/to agent $x_i$ (there are $d_i$ in total) the control input subtracts its value and for every neighbouring state its value is added.
Which can be written as
\begin{align}
	u_i & = - d_i x_i + \sum_j e_{ij} x_j.
\end{align}

This can be written in matrix notation using the Laplacian
\begin{align}
	\dot{x} & = - (D - E) x,\: \text{ where $x$ is the multi-agent state vector} \\
	\dot{x} & = - L x                                                            \\
	x       & = \begin{bmatrix}
		            x_1 & x_2 & \dots & x_N
	            \end{bmatrix}^T
\end{align}

\subsection{Leader}
A leader is an uncontrolled agent
\begin{align}
	\dot{x}_0 & = A x_0  \\
	y_0       & = C x_0.
\end{align}

The control of other agents is augmented with
\begin{align}
	g_i(x_0 - x_i),
\end{align}
where $g_i$ can be either binary element signifying whether the $i^{\rm th}$ agent is connected to the leader or it can be a control gain same as with $e_{ij}$.

The total control input is then
\begin{align}
	\dot{x}_i & = A x_i + BK \left[\sum_j e_{ij} (x_j - x_i) + g_i (x_0 - x_i)\right],
\end{align}
which can again be written in matrix notation
\begin{align}
	\dot{x} & = - (L + G) (x - \bm{1}_N x_0).
\end{align}

% -------------------------------------------------------------------------
\section{Write the single-integrator leaderless consensus dynamics in discrete time. How to include a leader?}
In discrete time the model of a single agent is
\begin{align}
	x_i(k+1) & = u_i(k).
\end{align}
Cooperative local neighborhood signal for control is
\begin{align}
	u_i(k) & = \frac{1}{1+d_i} \left[\sum_j e_{ij}(x_j(k) - x_i(k))\right] \\
	u_i(k) & = \frac{1}{1+d_i} \left[x_i(k) + \sum_j e_{ij}x_j(k)\right],
\end{align}
where $e_{ij}$ are elements of the adjacency matrix $E$.
In compact notation the closed loop system is
\begin{align}
	x(k+1) & = (I + D)^{-1} (I + E)x(k),
\end{align}
where $D = diag(d_i)$.

Perhaps a clearer way to write the equation is to define the input as
\begin{align}
	x_i(k+1)       & = x_i(k) + \tilde{u}_i(k)                                       \\
	\tilde{u}_i(k) & = - \frac{1}{1+d_i} \sum_j e_{ij} \left[x_i(k) - x_j(k)\right].
\end{align}
In matrix notation it can be rewritten using the Laplacian
\begin{align}
	x(k+1)       & = x(k) + \tilde{u}(k)     \\
	\tilde{u}(k) & = - (I + D)^{-1} L x (k).
\end{align}

\subsection{Leader}
We can add an uncontrolled leader $x_o$ and then add a pinning control term to the control input for every other agent
\begin{align}
	\tilde{u}_i(k) & = \frac{1}{1+d_i+g_i} \left[\sum_j e_{ij} \left[x_j(k) - x_i(k)\right] + g \left[x_0(k) - x_i(k)\right]\right]
\end{align}
or in matrix notation
\begin{align}
	\tilde{u}(k) & = -(I + D + G)^{-1}(L+G)\left[x(k) - \bm{1}_N x_0\right].
\end{align}

% -------------------------------------------------------------------------
\section{Set up the dynamical equations for continuous-time homogeneous LTI agents using local neighborhood error signal for state synchronization.}
A single agent has dynamics
\begin{align}
	\dot{x}_i & = A x_i + B u_i \\
	y_i       & = C x_i.
\end{align}
We assume there is a leader present
\begin{align}
	\dot{x}_0 & = Ax_0 \\
	y_0       & = Cx_0 \\
	u_0 = 0.
\end{align}
Then the goal is $||x_i - x_0|| \rightarrow 0$.

The distributed control is
\begin{align}
	u_i       & = cK\left[\sum_j e_{ij}(x_j - x_i) + g_i(x_0 - x_i)\right]           \\
	\dot{x}_i & = Ax_i + cBK \left[\sum_j e_{ij}(x_j - x_i) + g_i(x_0 - x_i)\right],
\end{align}
where $c > 0$ is a scalar gain.

In vector notation that is
\begin{align}
	\bm{x}            & =
	\begin{bmatrix}
		x_1    \\
		\vdots \\
		x_N    \\
	\end{bmatrix} \in \R^{nN}, \: x_i \in R^n                                                                           \\
	\bm{u}            & =
	\begin{bmatrix}
		u_1    \\
		\vdots \\
		u_N
	\end{bmatrix} \in \R^{mN}, \: u_i \in R^m                                                                           \\
	\bm{u}            & =
	\begin{cases}
		- L \otimes K \bm{x}\: \text{for swarming} \\
		- (L+G) \otimes K (\bm{x} - \bm{1} \otimes x_0)\: \text{for leader following}
	\end{cases}                                        \\
	\bm{\dot{x}}      & = \left[(I_N \otimes A) - c L \otimes BK\right] \bm{x}                                          \\
	\bm{\dot{\delta}} & = \left[(I_N \otimes A) - c (L+G) \otimes BK\right] \bm{\delta}, \: \text{for leader following}
\end{align}
The total system dynamic matrix has size $\R^{mN \times nN}$.

We are looking for a transformation $T$
\begin{align}
	T^{-1} L T & = \Lambda,
\end{align}
where $\Lambda$ is triangular.
\begin{align}
	(T^{-1} \otimes I_n) (I_N \otimes A - c L \otimes B K)(T \otimes I_n) \\
	T^{-1}T \otimes A - c T^{-1} L T \otimes B K                          \\
	I_n \otimes A - c\Lambda  \otimes B K                                 \\
	\text{On the diagonal of the matrix are blocks of} \: A - c \Lambda_{ii} B K \in \R^{n\times n}
\end{align}
Now we can analyze $N$ matrices of lower dimensionality then before. The eigenvalues of the blocks are the eigenvalues of the whole matrix.\\
The diagonal elements of $\Lambda$ are the eigenvalues of the graph Laplacian. One is zero and the other ones have non-negative real part.
The matrices on the block diagonal are $A - c \lambda_i B K \in \mathbb{C}^{n \times n}$.
Now we analyze the matrix pencil
\begin{align}
	A -  \sigma B K, \sigma \in \mathbb{C}.
\end{align}
For which $\sigma$ is the matrix asymptotically stable. These create the synchronizing region.
If we find a coupling gain $c$ such that all graph matrix eigenvalues end up in a synchronizing region, we can guarantee synchronization of a multi agent system using the feedback gain $K$\\
We require $(A,B)$ stabilizeable, $(A-BK)$ asymptotically stable for $\sigma = 1$.

\subsection{Lyapunov analysis}
\begin{align}
	V(z)                                                         = z ^{\dagger} P z, \: P & = P^T > 0    \\
	z ^{\dagger} [P (A - \sigma B K) + (A - \sigma B K)^{\dagger} P]z                     & = \dot{V}(z)
\end{align}

% -------------------------------------------------------------------------
\section{Show how to use complex matrix pencils for investigating state synchronization of homogeneous agents.}
\begin{warningbox}
	Proof/Derivation is required as a part of the exam
\end{warningbox}
If eigenvalues of $L + G$ are such that all these diagonal blocks are stable, then the entire system is stable in a sense that it asymptotically reaches synchronization to the leader's trajectory.
The stability of the total system is determined by stability of diagonal blocks,
\begin{align}
	A - c \lambda_j L B K.
\end{align}

Given $(A,B)$, for a chosen feedback matrix $K$ find a guaranteed region in the complex plane $\sigma \in \mathbb{C}$, such that the complex matrix pencil $(A - \sigma B K)$ is stable - results in the synchronizing region.\\
Then find the coupling gain $c > 0$ that pushes all the eigenvalues $\lambda_j(L + G)$ into that region.

% -------------------------------------------------------------------------
\section{Show that with the distributed feedback gain designed from the single-agent Algebraic Riccati Equation the resulting synchronizing region is an unbounded left-hand half-plane in the complex plane.}
\begin{warningbox}
	Proof/Derivation is required as a part of the exam
\end{warningbox}
Using Lyapunov analysis of stability
\TODO{Missing}

% % -------------------------------------------------------------------------
\section{What are the necessary topological conditions on the communication graph for consensus or synchronization? Explain the dynamical role of the Fiedler eigenvalue in continuous time single integrator consensus.}
\TODO{Missing}

\end{document}